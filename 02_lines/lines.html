<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Lines</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>

        const island = {
            "type": "FeatureCollection",
            "features": [
                {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "coordinates": [
                    [
                        [
                        -155.86639999999994,
                        20.262685630021508
                        ],
                        [
                        -155.89919865830117,
                        20.23515311827687
                        ],
                        [
                        -155.90351427123568,
                        20.192225064860665
                        ],
                        [
                        -155.8940199227799,
                        20.140371646895446
                        ],
                        [
                        -155.87675747104248,
                        20.09741750143293
                        ],
                        [
                        -155.84654818050177,
                        20.06093774802578
                        ],
                        [
                        -155.83014885135114,
                        20.03904582300349
                        ],
                        [
                        -155.82497011582987,
                        20.01796182606492
                        ],
                        [
                        -155.83101197393813,
                        19.986330530744695
                        ],
                        [
                        -155.83791695463316,
                        19.974162955989485
                        ],
                        [
                        -155.85172691602307,
                        19.964428219911028
                        ],
                        [
                        -155.87675747104248,
                        19.93846598679022
                        ],
                        [
                        -155.89747241312742,
                        19.91168796357033
                        ],
                        [
                        -155.91732423262556,
                        19.882470403703707
                        ],
                        [
                        -155.93199731660243,
                        19.856494714819448
                        ],
                        [
                        -155.9656590974907,
                        19.85324745453471
                        ],
                        [
                        -155.9999849672557,
                        19.82501833104412
                        ],
                        [
                        -156.02933113520942,
                        19.793348437271476
                        ],
                        [
                        -156.05954042575013,
                        19.768982692237486
                        ],
                        [
                        -156.05349856764198,
                        19.738114068633905
                        ],
                        [
                        -156.03968860625199,
                        19.680422495155483
                        ],
                        [
                        -156.02760489003578,
                        19.657665171314818
                        ],
                        [
                        -155.99912184466882,
                        19.631652847086187
                        ],
                        [
                        -155.9879012510395,
                        19.61945811945685
                        ],
                        [
                        -155.96632318636756,
                        19.585307961141922
                        ],
                        [
                        -155.9637172575605,
                        19.53315733897864
                        ],
                        [
                        -155.94904417358362,
                        19.500616131098298
                        ],
                        [
                        -155.93091859925923,
                        19.47213720388001
                        ],
                        [
                        -155.92401361856417,
                        19.442025466422137
                        ],
                        [
                        -155.90502492165302,
                        19.40620964185922
                        ],
                        [
                        -155.90502492165302,
                        19.371200191375067
                        ],
                        [
                        -155.8859352677047,
                        19.320849269678106
                        ],
                        [
                        -155.89750678358362,
                        19.255317256628985
                        ],
                        [
                        -155.90444969311085,
                        19.201780012631488
                        ],
                        [
                        -155.9113926026382,
                        19.147132206913042
                        ],
                        [
                        -155.9125497542261,
                        19.11214810806429
                        ],
                        [
                        -155.89634963199572,
                        19.070594875739502
                        ],
                        [
                        -155.87667805500166,
                        19.03778233038102
                        ],
                        [
                        -155.85926453539417,
                        19.023038060257576
                        ],
                        [
                        -155.81066416870294,
                        19.00991006082728
                        ],
                        [
                        -155.7886782885331,
                        18.99568689192165
                        ],
                        [
                        -155.7643781051875,
                        18.975991266864767
                        ],
                        [
                        -155.73660646707816,
                        18.968331228208555
                        ],
                        [
                        -155.7053633742052,
                        18.95191567448741
                        ],
                        [
                        -155.6810631908596,
                        18.92783660770303
                        ],
                        [
                        -155.68222034244747,
                        18.913606436647967
                        ],
                        [
                        -155.66486306862922,
                        18.917985079846545
                        ],
                        [
                        -155.65097724957462,
                        18.933309427774304
                        ],
                        [
                        -155.63246282416833,
                        18.94644346426142
                        ],
                        [
                        -155.62204845987745,
                        18.969425540999225
                        ],
                        [
                        -155.60469118605906,
                        18.971614145028823
                        ],
                        [
                        -155.59427682176815,
                        18.98693356836735
                        ],
                        [
                        -155.59427682176815,
                        19.00006338108807
                        ],
                        [
                        -155.57923385112554,
                        19.023038060257576
                        ],
                        [
                        -155.55377651619202,
                        19.042728114837743
                        ],
                        [
                        -155.55377651619202,
                        19.08319477980713
                        ],
                        [
                        -155.52369057490708,
                        19.11271827062356
                        ],
                        [
                        -155.50749045267656,
                        19.128024672722418
                        ],
                        [
                        -155.50749045267656,
                        19.13786375387373
                        ],
                        [
                        -155.4843474209191,
                        19.14114331731703
                        ],
                        [
                        -155.44847572169456,
                        19.152074724851587
                        ],
                        [
                        -155.4160754772337,
                        19.183771709660974
                        ],
                        [
                        -155.3894609907123,
                        19.200164308882606
                        ],
                        [
                        -155.3489606851363,
                        19.21436990726633
                        ],
                        [
                        -155.3362320176696,
                        19.237314819236403
                        ],
                        [
                        -155.31540328908753,
                        19.243869919640588
                        ],
                        [
                        -155.28878880256627,
                        19.268995378612914
                        ],
                        [
                        -155.26179229624728,
                        19.273907365313747
                        ],
                        [
                        -155.2318870211907,
                        19.264319834737265
                        ],
                        [
                        -155.19013248620604,
                        19.258993186552544
                        ],
                        [
                        -155.15740595878555,
                        19.26751574057812
                        ],
                        [
                        -155.08763508615075,
                        19.299006468656472
                        ],
                        [
                        -155.05998681298524,
                        19.31338450764349
                        ],
                        [
                        -155.00469026665414,
                        19.33574783264909
                        ],
                        [
                        -154.96542948489466,
                        19.352856422123722
                        ],
                        [
                        -154.95865847922144,
                        19.366697399220755
                        ],
                        [
                        -154.9293174546377,
                        19.39224688435762
                        ],
                        [
                        -154.88417741681644,
                        19.42151740625289
                        ],
                        [
                        -154.84016587994057,
                        19.45982721231212
                        ],
                        [
                        -154.81759586102993,
                        19.482702365129484
                        ],
                        [
                        -154.80518235062914,
                        19.497596076972158
                        ],
                        [
                        -154.80800360299293,
                        19.510892875747444
                        ],
                        [
                        -154.8159031096117,
                        19.526847591041786
                        ],
                        [
                        -154.83283062379462,
                        19.534292585753917
                        ],
                        [
                        -154.85540064270526,
                        19.544927697093087
                        ],
                        [
                        -154.8870344236633,
                        19.561236044304707
                        ],
                        [
                        -154.91693969871986,
                        19.581970398360227
                        ],
                        [
                        -154.9400739681032,
                        19.598449647892465
                        ],
                        [
                        -154.94797347472195,
                        19.612801167820024
                        ],
                        [
                        -154.94797347472195,
                        19.620773681047922
                        ],
                        [
                        -154.9637724879595,
                        19.626088470178388
                        ],
                        [
                        -154.98352125450623,
                        19.645220255155976
                        ],
                        [
                        -154.98352125450623,
                        19.661693020694784
                        ],
                        [
                        -154.98464975545176,
                        19.68719589968626
                        ],
                        [
                        -154.99304292572282,
                        19.71664056041861
                        ],
                        [
                        -155.00319943423267,
                        19.732043746302494
                        ],
                        [
                        -155.01392019321523,
                        19.733637094577645
                        ],
                        [
                        -155.0325404588164,
                        19.735761534219037
                        ],
                        [
                        -155.04495396921732,
                        19.735761534219037
                        ],
                        [
                        -155.05849598056366,
                        19.728325871855773
                        ],
                        [
                        -155.07655199569226,
                        19.72301447257064
                        ],
                        [
                        -155.09460801082074,
                        19.73469931793059
                        ],
                        [
                        -155.0929152594024,
                        19.765500720830232
                        ],
                        [
                        -155.0872727546748,
                        19.799481571511876
                        ],
                        [
                        -155.09517226129344,
                        19.81169166841748
                        ],
                        [
                        -155.0861442537293,
                        19.841947432886045
                        ],
                        [
                        -155.0908324130267,
                        19.861841448499405
                        ],
                        [
                        -155.10775992720966,
                        19.868740214008085
                        ],
                        [
                        -155.1179164357195,
                        19.884659296353377
                        ],
                        [
                        -155.14161495557568,
                        19.915962157600404
                        ],
                        [
                        -155.160235221177,
                        19.931346039402627
                        ],
                        [
                        -155.1850622419787,
                        19.949910798717113
                        ],
                        [
                        -155.19729470343995,
                        19.952922928642067
                        ],
                        [
                        -155.2102724643136,
                        19.972545782779576
                        ],
                        [
                        -155.23735648700637,
                        19.986863621679646
                        ],
                        [
                        -155.25259124977106,
                        19.996938357974386
                        ],
                        [
                        -155.26782601253575,
                        20.009663419217375
                        ],
                        [
                        -155.29491003522855,
                        20.01867638165872
                        ],
                        [
                        -155.3502561226867,
                        20.04813768471503
                        ],
                        [
                        -155.4027314166539,
                        20.07357848714466
                        ],
                        [
                        -155.44787145447515,
                        20.092656380657374
                        ],
                        [
                        -155.48511198567766,
                        20.105373685642945
                        ],
                        [
                        -155.50203949986073,
                        20.110672257819118
                        ],
                        [
                        -155.52460951877137,
                        20.113851315009157
                        ],
                        [
                        -155.54830803862754,
                        20.12497750642177
                        ],
                        [
                        -155.56185004997386,
                        20.12444770573248
                        ],
                        [
                        -155.58667707077558,
                        20.121268863896546
                        ],
                        [
                        -155.60529733637688,
                        20.127096691228644
                        ],
                        [
                        -155.63533424445973,
                        20.143441959693718
                        ],
                        [
                        -155.6437980015512,
                        20.152976938211125
                        ],
                        [
                        -155.66354676809806,
                        20.16833762312352
                        ],
                        [
                        -155.69345204315465,
                        20.182637590898665
                        ],
                        [
                        -155.71940756490187,
                        20.19746580153239
                        ],
                        [
                        -155.73633507908482,
                        20.21123359030591
                        ],
                        [
                        -155.7346423276666,
                        20.220764423008248
                        ],
                        [
                        -155.75495534468615,
                        20.23241242551684
                        ],
                        [
                        -155.77357561028745,
                        20.24405955531803
                        ],
                        [
                        -155.7905031244704,
                        20.2498827928235
                        ],
                        [
                        -155.8153301452721,
                        20.26099927628387
                        ],
                        [
                        -155.84128566701935,
                        20.264704593876687
                        ],
                        [
                        -155.86639999999994,
                        20.262685630021508
                        ]
                    ]
                    ],
                    "type": "Polygon"
                }
                }
            ]
        }

        const mapStyle = {
        'version': 8,
        'sources': {
            'satellite': {
            'type': 'raster',
            'url': 'mapbox://mapbox.satellite',
            'tileSize': 256
            }
        },
        'layers': [
            {
            'id': 'background',
            'type': 'background',
            'paint': {
                'background-color': 'rgb(4,7,14)'
            }
            },
            {
            'id': 'satellite',
            'type': 'raster',
            'source': 'satellite',
            'paint': {
                'raster-saturation': -1
            }
            }
        ]};

        let initLoad = true;
        let waveCount = 60;
        
        // please use your own token!
        mapboxgl.accessToken = 'pk.eyJ1Ijoid2lsbGlhbS1kYXZpcyIsImEiOiJja2tiYWtvbWcwMmtzMnBvajh3M2kxZGRuIn0.GeROaHKn2Gbvsg1e8buJEw';
        const map = new mapboxgl.Map({
            container: 'map',
            style: mapStyle,
            center: [-155.8, 19.35],
            zoom: 8.9,
            minZoom: 7,
            pitch: 50,
            bearing: 50,
            projection: 'mercator'
        });

        map.on('load', () => {
            map.addSource('mapbox-dem', {
                'type': 'raster-dem',
                'url': 'mapbox://mapbox.terrain-rgb',
                'tileSize': 512,
                'maxzoom': 14,
                'minzoom': 0
            });
            map.setTerrain({
                'source': 'mapbox-dem',
                'exaggeration': 4.5
            });

            map.once('idle', () => {
                setInterval(generateIsland, 60);
            });
        });

        function generateIsland() {
            const collection = turf.featureCollection([]);
            const mask = turf.mask(island);
            const totalWaves = 60;

            if (initLoad) {
                initLoad = false;
                for (let i=0;i <= totalWaves; i++) {
                    let waveVal = i*0.15;
                    const waveBuffer = turf.buffer(island, waveVal, {units: 'miles'});
                    
                    if (i > 30) {
                        waveBuffer.features[0].properties = {
                            'id': i, 
                            'distance': waveVal,
                            'waveOpacity': 2-(i/(totalWaves/2))
                        };
                    } else {
                        waveBuffer.features[0].properties = {
                            'id': i,
                            'distance': waveVal,
                            'waveOpacity': i/(totalWaves/2)
                        };
                    }
                    
                    collection.features.push(waveBuffer.features[0]);
                }
                
                map.addSource('mask', {
                    'type': 'geojson',
                    'data': mask
                });

                map.addSource('buffer', {
                    'type': 'geojson',
                    'data': collection
                });

                map.addLayer({
                    'id': 'maskFill',
                    'type': 'fill',
                    'source': 'mask',
                    'paint': {
                        'fill-color': '#fff'
                    }
                });

                map.addLayer({
                    'id': 'maskLine',
                    'type': 'line',
                    'source': 'mask',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#000',
                        'line-width': 0,
                    }
                });

                map.addLayer({
                    'id': 'bufferLine',
                    'type': 'line',
                    'source': 'buffer',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#222',
                        'line-width': 2,
                        'line-blur': 2,
                        'line-opacity': ['get', 'waveOpacity']
                    }
                });
            } else {
                if (waveCount > 1) {
                    map.setFilter('bufferLine', ['==', ['get', 'id'], waveCount])
                } else {
                    waveCount = totalWaves;
                    map.setFilter('bufferLine', ['==', ['get', 'id'], waveCount]);
                }
                --waveCount
            }
        }
</script>
</body>
</html>